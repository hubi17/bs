<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML><HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Regex Tutorial - If-Then-Else Conditionals</TITLE>
<script src="regex.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="Regex Guru" href="http://www.regexguru.com/feed/">
<META NAME="Author" CONTENT="Jan Goyvaerts">
<META NAME="Description" CONTENT="In Perl's regex flavor, and compatible flavors, you can use a special construct to create conditional if-then-else regular expressions.">
<META NAME="Keywords" CONTENT="">
<LINK REL=StyleSheet HREF="regex.css" TYPE="text/css">
</HEAD>
<BODY BGCOLOR=white TEXT=black>
<script type="text/javascript">window.onresize = movecontent;</script>
<DIV id=top><DIV id=logo><IMG SRC="img/logo.gif" WIDTH=530 HEIGHT=100></DIV></DIV>
<div id=btntop><table align=center cellspacing=0 cellpadding=0 border=0><tr><td><a href="tutorial.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Tutorial</div></a></td><td><a href="tools.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Tools&nbsp;&amp;&nbsp;Languages</div></a></td><td><a href="examples.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Examples</div></a></td><td><a href="books.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Books&nbsp;&amp;&nbsp;Reference</div></a></td></tr></table></div>
<DIV id=bodytext>
<script type="text/javascript">movecontent();</script>
<TABLE CLASS=topad> <TR><TD VALIGN=top><A HREF="http://www.regexbuddy.com/create.html" TARGET="_top"><IMG SRC="img/regexbuddyad.png" width=203 height=145 ALT="RegexBuddy" BORDER=0></A></TD> <TD CLASS=topad><B><A HREF="http://www.regexbuddy.com/create.html" TARGET="_top">Easily create and understand regular expressions today</A>.</B><BR> Compose and analyze regex patterns with RegexBuddy's easy-to-grasp regex blocks and intuitive regex tree, instead of or in combination with the traditional regex syntax. Developed by the author of this website, RegexBuddy makes learning and using regular expressions easier than ever. <A HREF="http://www.regexbuddy.com/">Get your own copy of RegexBuddy now</A></TD> </TR></TABLE>  <H1>If-Then-Else Conditionals in Regular Expressions</H1> <P>A special construct <TT CLASS=regex>(?ifthen|else)</TT> allows you to create conditional regular expressions. If the <EM>if</EM> part evaluates to true, then the regex engine will attempt to match the <EM>then</EM> part. Otherwise, the <EM>else</EM> part is attempted instead. The syntax consists of a pair of round brackets. The opening bracket must be followed by a question mark, immediately followed by the <EM>if</EM> part, immediately followed by the <EM>then</EM> part. This part can be followed by a vertical bar and the <EM>else</EM> part. You may omit the <EM>else</EM> part, and the vertical bar with it.</P> <P>For the <EM>if</EM> part, you can use the <A HREF="lookaround.html" TARGET="_top">lookahead and lookbehind</A> constructs. Using positive lookahead, the syntax becomes <TT CLASS=regex>(?(?=regex)then|else)</TT>. Because the lookahead has its own parentheses, the <EM>if</EM> and <EM>then</EM> parts are clearly separated.</P> <P>Remember that the lookaround constructs do not consume any characters. If you use a lookahead as the <EM>if</EM> part, then the regex engine will attempt to match the <EM>then</EM> or <EM>else part</EM> (depending on the outcome of the lookahead) at the same position where the <EM>if</EM> was attempted.</P> <P>Alternatively, you can check in the <EM>if</EM> part whether a <A HREF="brackets.html" TARGET="_top">capturing group</A> has taken part in the match thus far. Place the number of the capturing group inside round brackets, and use that as the if part. Note that although the syntax for a conditional check on a backreference is the same as a number inside a capturing group, no capturing group is created. The number and the brackets are part of the if-then-else syntax started with <TT CLASS=regex>(?</TT>.</P> <P>For the <EM>then</EM> and <EM>else</EM>, you can use any regular expression. If you want to use <A HREF="alternation.html" TARGET="_top">alternation</A>, you will have to group the <EM>then</EM> or <EM>else</EM> together using <A HREF="brackets.html" TARGET="_top">parentheses</A>, like in <TT CLASS=regex>(?(?=condition)(then1|then2|then3)|(else1|else2|else3))</TT>. Otherwise, there is no need to use parentheses around the <EM>then</EM> and <EM>else</EM> parts.</P> <script type="text/javascript"><!--
google_ad_client = "pub-7485249680256358";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "FF6600";
google_color_bg = "FFF4E8";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "803300";
google_ui_features = "rc:0";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script><H2>Looking Inside the Regex Engine</H2> <P>The regex <TT CLASS=regex>(a)?b(?(1)c|d)</TT> matches <TT CLASS=match>bd</TT> and <TT class=match>abc</TT>. It does not match <tt class=string>bc</tt>, but does match <TT CLASS=match>bd</TT> in <TT CLASS=string>abd</TT>. Let's see how this regular expression works on each of these four subject strings.</p> <p>When applied to <TT CLASS=string>bd</TT>, <tt class=regex>a</tt> fails to match. Since the capturing group containing <tt class=regex>a</tt> is optional, the engine continues with <tt class=regex>b</tt> at the start of the subject string. Since the whole group was optional, the group did not take part in the match. Any subsequent <A HREF="brackets.html" TARGET="_top">backreference</A> to it like <tt class=regex>\1</tt> will fail. Note that <TT CLASS=regex>(a)?</TT> is very different from <TT CLASS=regex>(a?)</TT>. In the former regex, the capturing group does not take part in the match if <TT CLASS=regex>a</TT> fails, and backreferences to the group will fail. In the latter group, the capturing group always takes part in the match, capturing either <TT CLASS=match>a</TT> or nothing. Backreferences to a capturing group that took part in the match and captured nothing always succeed. Conditionals evaluating such groups execute the "then" part. In short: if you want to use a reference to a group in a conditional, use <TT CLASS=regex>(a)?</TT> instead of <TT CLASS=regex>(a?)</TT>.</p> <p>Continuing with our regex, <tt class=regex>b</tt> matches <tt class=match>b</tt>. The regex engine now evaluates the conditional. The first capturing group did not take part in the match at all, so the "else" part or <tt class=regex>d</tt> is attempted. <tt class=regex>d</tt> matches <tt class=match>d</tt> and an overall match is found.</p> <p>Moving on to our second subject string <TT class=string>abc</TT>, <tt class=regex>a</tt> matches <tt class=match>a</tt>, which is captured by the capturing group. Subsequently, <tt class=regex>b</tt> matches <tt class=match>b</tt>. The regex engine again evaluates the conditional. The capturing group took part in the match, so the "then" part or <tt class=regex>c</tt> is attempted. <tt class=regex>c</tt> matches <tt class=match>c</tt> and an overall match is found.</p> <p>Our third subject <tt class=string>bc</tt> does not start with <tt class=string>a</tt>, so the capturing group does not take part in the match attempt, like we saw with the first subject string. <tt class=regex>b</tt> still matches <tt class=match>b</tt>, and the engine moves on to the conditional. The first capturing group did not take part in the match at all, so the "else" part or <tt class=regex>d</tt> is attempted. <tt class=regex>d</tt> does not match <tt class=string>c</tt> and the match attempt at the start of the string fails. The engine does try again starting at the second character in the string, but fails since <tt class=regex>b</tt> does not match <tt class=string>c</tt>.</p> <p>The fourth subject <TT CLASS=string>abd</TT> is the most interesting one. Like in the second string, the capturing group grabs the <TT CLASS=match>a</TT> and the <TT CLASS=regex>b</TT> matches. The capturing group took part in the match, so the "then" part or <tt class=regex>c</tt> is attempted. <tt class=regex>c</tt> fails to match <tt class=string>d</tt>, and the match attempt fails. Note that the "else" part is not attempted at this point. The capturing group took part in the match, so only the "then" part is used. However, the regex engine isn't done yet. It will restart the regular expression from the beginning, moving ahead one character in the subject string.</p> <p>Starting at the second character in the string, <TT CLASS=regex>a</TT> fails to match <TT CLASS=string>b</TT>. The capturing group does not take part in the second match attempt which started at the second character in the string. The regex engine moves beyond the optional group, and attempts <TT CLASS=regex>b</TT>, which matches. The regex engine now arrives at the conditional in the regex, and at the third character in the subject string. The first capturing group did not take part in the current match attempt, so the "else" part or <tt class=regex>d</tt> is attempted. <tt class=regex>d</tt> matches <tt class=match>d</tt> and an overall match <tt class=match>bd</tt> is found.</p> <p>If you want to avoid this last match result, you need to use <A HREF="anchors.html" TARGET="_top">anchors</A>. <TT CLASS=regex>^(a)?b(?(1)c|d)$</TT> does not find any matches in the last subject string. The caret will fail to match at the second and third characters in the string.</p> <H2>Regex Flavors</H2> <P>Conditionals are supported by <A HREF="jgsoft.html" TARGET="_top">the JGsoft engine</A>, <A HREF="perl.html" TARGET="_top">Perl</A>, <A HREF="pcre.html" TARGET="_top">PCRE</A> and the <A HREF="dotnet.html" TARGET="_top">.NET framework</A>. All these flavors, except Perl, also support <A HREF="named.html" TARGET="_top">named capturing groups</A>. They allow you to use the name of a capturing group instead of its number as the <EM>if</EM> test, e.g.: <TT CLASS=regex>(?&lt;test&gt;a)?b(?(test)c|d)</TT>.</P> <p><A HREF="python.html" TARGET="_top">Python</A> supports conditionals using a numbered or named capturing group. Python does not support conditionals using lookaround, even though Python does support lookaround outside conditionals. Instead of a conditional like <TT CLASS=regex>(?(?=regex)then|else)</TT>, you can alternate two opposite lookarounds: <TT CLASS=regex>(?=regex)then|(?!regex)else)</TT>.</p> <H2>Example: Extract Email Headers</H2> <P>The regex <TT CLASS=regex>^((From|To)|Subject): ((?(2)\w+@\w+\.[a-z]+|.+))</TT> extracts the From, To, and Subject headers from an email message. The name of the header is captured into the first backreference. If the header is the From or To header, it is captured into the second backreference as well.</P> <P>The second part of the pattern is the if-then-else conditional <TT CLASS=regex>(?(2)\w+@\w+\.[a-z]+|.+))</TT>. The <em>if</em> part checks whether the second capturing group took part in the match thus far. It will have taken part if the header is the From or To header. In that case, the <EM>then</EM> part of the conditional <TT CLASS=regex>\w+@\w+\.[a-z]+</TT> tries to <A HREF="email.html" TARGET="_top">match an email address</A>. To keep the example simple, we use an overly simple regex to match the email address, and we don't try to match the display name that is usually also part of the From or To header.</P> <P>If the second capturing group did not participate in the match this far, the <EM>else</EM> part <TT CLASS=regex>.+</TT> is attempted instead. This simply matches the remainder of the line, allowing for any test subject.</P> <P>Finally, we place an extra pair of round brackets around the conditional. This captures the contents of the email header matched by the conditional into the third backreference. The conditional itself does not capture anything. When implementing this regular expression, the first capturing group will store the name of the header ("From", "To", or "Subject"), and the third capturing group will store the value of the header.</P> <p>You could try to match even more headers by putting another conditional into the "else" part. E.g. <TT CLASS=regex>^((From|To)|(Date)|Subject): ((?(2)\w+@\w+\.[a-z]+|(?(3)mm/dd/yyyy|.+))</TT> would match a "From", "To", "Date" or "Subject", and use the regex <tt class=regex>mm/dd/yyyy</tt> to check whether the <A HREF="dates.html" TARGET="_top">date is valid</A>. Obviously, the date validation regex is just a dummy to keep the example simple. The header is captured in the first group, and its validated contents in the fourth group.</p> <p>As you can see, regular expressions using conditionals quickly become unwieldy. I recommend that you only use them if one regular expression is all your tool allows you to use. When programming, you're far better of using the regex <TT CLASS=regex>^(From|To|Date|Subject): (.+)</TT> to capture one header with its unvalidated contents. In your source code, check the name of the header returned in the first capturing group, and then use a second regular expression to validate the contents of the header returned in the second capturing group of the first regex. Though you'll have to write a few lines of extra code, this code will be much easier to understand and maintain. If you precompile all the regular expressions, using multiple regular expressions will be just as fast, if not faster, than the one big regex stuffed with conditionals.</p> <h2>Make a Donation</h2>
<p>Did this website just save you a trip to the bookstore?  Please <a href="donate.html">make a donation</a> to support this site, and you'll get a lifetime of advertisement-free access to this site!</p>
<DIV id=copyright>
<P CLASS=copyright>Page URL: <A HREF="conditional.html" TARGET="_top">http://www.Regular-Expressions.info/conditional.html</A><BR>
Page last updated: 20 August 2012<BR>
Site last updated: 17 June 2013<BR>
Copyright &copy; 2003-2013 Jan Goyvaerts. All rights reserved.</P>
</DIV> 

<script type="text/javascript"><!--
var google_conversion_id = 1072547447; var google_conversion_language = "en"; var google_conversion_format = "3"; var google_conversion_color = "666666"; var google_conversion_label = "sqPQCInO3QEQ94y3_wM"; var google_conversion_value = 0;
//-->
</script>
<script type="text/javascript" src="http://www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="http://www.googleadservices.com/pagead/conversion/1072547447/?label=sqPQCInO3QEQ94y3_wM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
</DIV> 
<DIV id=side><script type="text/javascript">movecontent();</script><TABLE CLASS=side CELLSPACING=0 CELLPADDING=4><TR><TD CLASS=sideheader>Regex Tutorial</TD></TR><TR><TD><A HREF="tutorial.html" TARGET=_top>Introduction</A></TD></TR><TR><TD><A HREF="tutorialcnt.html" TARGET=_top>Table&nbsp;of&nbsp;Contents</A></TD></TR><TR><TD><A HREF="characters.html" TARGET=_top>Characters</A></TD></TR><TR><TD><A HREF="engine.html" TARGET=_top>Regex&nbsp;Engine&nbsp;Internals</A></TD></TR><TR><TD><A HREF="charclass.html" TARGET=_top>Character&nbsp;Classes</A></TD></TR><TR><TD><A HREF="dot.html" TARGET=_top>Dot</A></TD></TR><TR><TD><A HREF="anchors.html" TARGET=_top>Anchors</A></TD></TR><TR><TD><A HREF="wordboundaries.html" TARGET=_top>Word&nbsp;Boundaries</A></TD></TR><TR><TD><A HREF="alternation.html" TARGET=_top>Alternation</A></TD></TR><TR><TD><A HREF="optional.html" TARGET=_top>Optional&nbsp;Items</A></TD></TR><TR><TD><A HREF="repeat.html" TARGET=_top>Repetition</A></TD></TR><TR><TD><A HREF="brackets.html" TARGET=_top>Grouping&nbsp;&amp;&nbsp;Backreferences</A></TD></TR><TR><TD><A HREF="named.html" TARGET=_top>Named&nbsp;Groups</A></TD></TR><TR><TD><A HREF="unicode.html" TARGET=_top>Unicode</A></TD></TR><TR><TD><A HREF="modifiers.html" TARGET=_top>Modifiers</A></TD></TR><TR><TD><A HREF="possessive.html" TARGET=_top>Possessive&nbsp;Quantifiers</A></TD></TR><TR><TD><A HREF="atomic.html" TARGET=_top>Atomic&nbsp;Grouping</A></TD></TR><TR><TD><A HREF="lookaround.html" TARGET=_top>Lookahead&nbsp;&amp;&nbsp;Lookbehind</A></TD></TR><TR><TD><A HREF="lookaround2.html" TARGET=_top>Lookaround,&nbsp;part&nbsp;2</A></TD></TR><TR><TD><A HREF="continue.html" TARGET=_top>Continuing&nbsp;Matches</A></TD></TR><TR><TD><A HREF="conditional.html" TARGET=_top>Conditionals</A></TD></TR><TR><TD><A HREF="xmlcharclass.html" TARGET=_top>XML&nbsp;Character&nbsp;Classes</A></TD></TR><TR><TD><A HREF="posixbrackets.html" TARGET=_top>POSIX&nbsp;Bracket&nbsp;Expressions</A></TD></TR><TR><TD><A HREF="comments.html" TARGET=_top>Comments</A></TD></TR><TR><TD><A HREF="freespacing.html" TARGET=_top>Free-Spacing</A></TD></TR>
</TABLE><TABLE CLASS=side CELLSPACING=0 CELLPADDING=4><TR><TD CLASS=sideheader>More Information</TD></TR><TR><TD><A HREF="index.html" TARGET=_top>Introduction</A></TD></TR><TR><TD><A HREF="quickstart.html" TARGET=_top>Quick&nbsp;Start</A></TD></TR><TR><TD><A HREF="tutorial.html" TARGET=_top>Tutorial</A></TD></TR><TR><TD><A HREF="tools.html" TARGET=_top>Tools&nbsp;and&nbsp;Languages</A></TD></TR><TR><TD><A HREF="examples.html" TARGET=_top>Examples</A></TD></TR><TR><TD><A HREF="books.html" TARGET=_top>Books</A></TD></TR><TR><TD><A HREF="reference.html" TARGET=_top>Reference</A></TD></TR><TR><TD><A HREF="print.html" TARGET=_top>Print&nbsp;PDF</A></TD></TR><TR><TD><A HREF="about.html" TARGET=_top>About&nbsp;This&nbsp;Site</A></TD></TR><TR><TD><A HREF="updates.html" TARGET=_top>RSS&nbsp;Feed&nbsp;&amp;&nbsp;Blog</A></TD></TR></TABLE><iframe class="amazonsingle" src="http://rcm.amazon.com/e/cm?t=jgsbookselection&o=1&p=8&l=as1&asins=1449319432&md=10FE9736YVPPT7A0FBG2&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe><P>&nbsp;</P> <TABLE CLASS=sidead CELLSPACING=0 CELLPADDING=4> <TR><TD CLASS=sideheader>PowerGREP 4</TD></TR> <TR><TD CLASS=ad><A HREF="http://www.powergrep.com/" TARGET=_top><IMG SRC="img/pgr.gif" WIDTH=32 HEIGHT=32 ALT="PowerGREP" ALIGN=LEFT CLASS=iconleft BORDER=0></A> <A HREF="http://www.powergrep.com/" TARGET=_top>PowerGREP</A> is probably the most powerful regex-based text processing tool available today. A knowledge worker's Swiss army knife for searching through, extracting information from, and updating piles of files.</TD></TR> <TR><TD CLASS=ad>Use regular expressions to search through large numbers of text and binary files. Quickly find the files you are looking for, or extract the information you need. Look through just a handful of files or folders, or scan entire drives and network shares.</TD></TR> <TR><TD CLASS=ad>Search and replace using text, binary data or one or more regular expressions to automate repetitive editing tasks. Preview replacements before modifying files, and stay safe with flexible backup and undo options.</TD></TR> <TR><TD CLASS=ad>Use regular expressions to rename files, copy files, or merge and split the contents of files. Work with plain text files, Unicode files, binary files, compressed files, and files in proprietary formats such as MS Office, OpenOffice, and PDF. Runs on Windows 2000, XP, Vista, 7, and 8.</TD></TR> <TR><TD><A HREF="http://www.powergrep.com/" TARGET=_top>More information</A></TD></TR> <TR><TD><A HREF="http://www.powergrep.com/download.html" TARGET=_top>Download PowerGREP now</A></TD></TR> </TABLE></DIV><script type="text/javascript">movecontent();</script></BODY></HTML>