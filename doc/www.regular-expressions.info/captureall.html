<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML><HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Repeating a Capturing Group vs. Capturing a Repeated Group</TITLE>
<script src="regex.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="Regex Guru" href="http://www.regexguru.com/feed/">
<META NAME="Author" CONTENT="Jan Goyvaerts">
<META NAME="Description" CONTENT="Repeating a capturing group in a regular expression is not the same as capturing a repeated group">
<META NAME="Keywords" CONTENT="">
<LINK REL=StyleSheet HREF="regex.css" TYPE="text/css">
</HEAD>
<BODY BGCOLOR=white TEXT=black>
<script type="text/javascript">window.onresize = movecontent;</script>
<DIV id=top><DIV id=logo><IMG SRC="img/logo.gif" WIDTH=530 HEIGHT=100></DIV></DIV>
<div id=btntop><table align=center cellspacing=0 cellpadding=0 border=0><tr><td><a href="tutorial.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Tutorial</div></a></td><td><a href="tools.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Tools&nbsp;&amp;&nbsp;Languages</div></a></td><td><a href="examples.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Examples</div></a></td><td><a href="books.html" target="_top"><div onmouseover="this.style.backgroundColor='#33A000';this.style.backgroundImage='url(img/btnhot.gif)';" onmouseout="this.style.backgroundColor='#A03300';this.style.backgroundImage='url(img/btn.gif)';return false;">Books&nbsp;&amp;&nbsp;Reference</div></a></td></tr></table></div>
<DIV id=bodytext>
<script type="text/javascript">movecontent();</script>
 <TABLE CLASS=topad> <TR><TD VALIGN=top><A HREF="http://www.regexbuddy.com/debug.html" TARGET="_top"><IMG SRC="img/regexbuddyad.png" width=203 height=145 ALT="RegexBuddy" BORDER=0></A></TD> <TD CLASS=topad><B><A HREF="http://www.regexbuddy.com/debug.html" TARGET="_top">Figure out why your regular expression isn't working</A> with RegexBuddy.</B><BR> RegexBuddy's regular expression debugger offers you a unique view inside the regular expression engine. It shows you exactly how and why your regex works, or doesn't. Stop guessing. Fix your regular expressions with knowledge instead of by trial and error. <A HREF="http://www.regexbuddy.com/">Get your own copy of RegexBuddy now</A>.</TD> </TR></TABLE>  <H1>Repeating a Capturing Group vs. Capturing a Repeated Group</H1> <p>When creating a regular expression that needs a <A HREF="brackets.html" TARGET="_top">capturing group</A> to grab part of the text matched, a common mistake is to <A HREF="repeat.html" TARGET="_top">repeat</A> the capturing group instead of capturing a repeated group. The difference is that the repeated capturing group will capture only the last iteration, while a group capturing another group that's repeated will capture all iterations. An example will make this clear.</p> <p>Let's say you want to match a tag like <tt class=match>!abc!</tt> or <tt class=match>!123!</tt>. Only these two are possible, and you want to capture the <tt class=match>abc</tt> or <tt class=match>123</tt> to figure out which tag you got. That's easy enough: <tt class=regex>!(abc|123)!</tt> will do the trick.</p> <p>Now let's say that the tag can contain multiple sequences of <tt class=string>abc</tt> and <tt class=string>123</tt>, like <tt class=match>!abc123!</tt> or <tt class=match>!123abcabc!</tt>. The quick and easy solution is <tt class=regex>!(abc|123)+!</tt>. This regular expression will indeed match these tags. However, it no longer meets our requirement to capture the tag's label into the capturing group. When this regex matches <tt class=match>!abc123!</tt>, the capturing group stores only <tt class=match>123</tt>. When it matches <tt class=match>!123abcabc!</tt>, it only stores <tt class=match>abc</tt>.</p> <p>This is easy to understand if we look at how the regex engine applies <tt class=regex>!(abc|123)+!</tt> to <tt class=string>!abc123!</tt>. First, <tt class=regex>!</tt> matches <tt class=match>!</tt>. The engine then enters the capturing group. It makes note that capturing group #1 was entered when the engine reached the position between the first and second character in the subject string. The first token in the group is <tt class=regex>abc</tt>, which matches <tt class=match>abc</tt>. A match is found, so the second alternative isn't tried. (The engine does store a backtracking position, but this won't be used in this example.) The engine now leaves the capturing group. It makes note that capturing group #1 was exited when the engine reached the position between the 4th and 5th characters in the string.</p> <p>After having exited from the group, the engine notices the <A HREF="repeat.html" TARGET="_top">plus</A>. The plus is greedy, so the group is tried again. The engine enters the group again, and takes note that capturing group #1 was entered between the 4th and 5th characters in the string. It also makes note that since the plus is not <A HREF="possessive.html" TARGET="_top">possessive</A>, it may be backtracked. That is, if the group cannot be matched a second time, that's fine. In this backtracking note, the regex engine also saves the entrance and exit positions of the group during the previous iteration of the group.</p> <p><tt class=regex>abc</tt> fails to match <tt class=string>123</tt>, but <tt class=regex>123</tt> succeeds. The group is exited again. The exit position between characters 7 and 8 is stored.</p> <p>The plus allows for another iteration, so the engine tries again. Backtracking info is stored, and the new entrance position for the group is saved. But now, both <tt class=regex>abc</tt> and <tt class=regex>123</tt> fail to match <tt class=string>!</tt>. The group fails, and the engine backtracks. While backtracking, the engine restores the capturing positions for the group. Namely, the group was entered between characters 4 and 5, and existed between characters 7 and 8.</p> <p>The engine proceeds with <tt class=regex>!</tt>, which matches <tt class=match>!</tt>. An overall match is found. The overall match spans the whole subject string. The capturing group spaces characters 5, 6 and 7, or <tt class=match>123</tt>. Backtracking information is discarded when a match is found, so there's no way to tell after the fact that the group had a previous iteration that matched <tt class=match>abc</tt>. (The only exception to this is the <A HREF="dotnet.html" TARGET="_top">.NET</A> regex engine, which does preserve backtracking information for capturing groups after the match attempt.)</p> <p>The solution to capturing <tt class=match>abc123</tt> in this example should be obvious now: the regex engine should enter and leave the group only once. This means that the plus should be inside the capturing group rather than outside. Since we do need to group the two alternatives, we'll need to place a second capturing group around the repeated group: <tt class=regex>!((abc|123)+)!</tt>. When this regex matches <tt class=match>!abc123!</tt>, capturing group #1 will store <tt class=match>abc123</tt>, and group #2 will store <tt class=match>123</tt>. Since we're not interested in the inner group's match, we can optimize this regular expression by making the inner group non-capturing: <tt class=regex>!((?:abc|123)+)!</tt>.<script type="text/javascript"><!--
google_ad_client = "pub-7485249680256358";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "FF6600";
google_color_bg = "FFF4E8";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "803300";
google_ui_features = "rc:0";
//-->
</script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script><h2>Make a Donation</h2>
<p>Did this website just save you a trip to the bookstore?  Please <a href="donate.html">make a donation</a> to support this site, and you'll get a lifetime of advertisement-free access to this site!</p>
<DIV id=copyright>
<P CLASS=copyright>Page URL: <A HREF="captureall.html" TARGET="_top">http://www.Regular-Expressions.info/captureall.html</A><BR>
Page last updated: 07 July 2009<BR>
Site last updated: 17 June 2013<BR>
Copyright &copy; 2003-2013 Jan Goyvaerts. All rights reserved.</P>
</DIV> 

<script type="text/javascript"><!--
var google_conversion_id = 1072547447; var google_conversion_language = "en"; var google_conversion_format = "3"; var google_conversion_color = "666666"; var google_conversion_label = "sqPQCInO3QEQ94y3_wM"; var google_conversion_value = 0;
//-->
</script>
<script type="text/javascript" src="http://www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="http://www.googleadservices.com/pagead/conversion/1072547447/?label=sqPQCInO3QEQ94y3_wM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
</DIV> 
<DIV id=side><script type="text/javascript">movecontent();</script><TABLE CLASS=side CELLSPACING=0 CELLPADDING=4><TR><TD CLASS=sideheader>Examples</TD></TR><TR><TD><A HREF="examples.html" TARGET=_top>Examples</A></TD></TR><TR><TD><A HREF="numericranges.html" TARGET=_top>Numeric&nbsp;Ranges</A></TD></TR><TR><TD><A HREF="floatingpoint.html" TARGET=_top>Floating&nbsp;Point&nbsp;Numbers</A></TD></TR><TR><TD><A HREF="email.html" TARGET=_top>Email&nbsp;Addresses</A></TD></TR><TR><TD><A HREF="dates.html" TARGET=_top>Valid&nbsp;Dates</A></TD></TR><TR><TD><A HREF="creditcard.html" TARGET=_top>Credit&nbsp;Card&nbsp;Numbers</A></TD></TR><TR><TD><A HREF="completelines.html" TARGET=_top>Matching&nbsp;Complete&nbsp;Lines</A></TD></TR><TR><TD><A HREF="duplicatelines.html" TARGET=_top>Deleting&nbsp;Duplicate&nbsp;Lines</A></TD></TR><TR><TD><A HREF="examplesprogrammer.html" TARGET=_top>Programming</A></TD></TR><TR><TD><A HREF="near.html" TARGET=_top>Two&nbsp;Near&nbsp;Words</A></TD></TR>
</TABLE><TABLE CLASS=side CELLSPACING=0 CELLPADDING=4><TR><TD CLASS=sideheader>Pitfalls</TD></TR><TR><TD><A HREF="catastrophic.html" TARGET=_top>Catastrophic&nbsp;Backtracking</A></TD></TR><TR><TD><A HREF="floatingpoint.html" TARGET=_top>Making&nbsp;Everything&nbsp;Optional</A></TD></TR><TR><TD><A HREF="captureall.html" TARGET=_top>Repeated&nbsp;Capturing&nbsp;Group</A></TD></TR><TR><TD><A HREF="unicode8bit.html" TARGET=_top>Mixing&nbsp;Unicode&nbsp;&amp;&nbsp;8-bit</A></TD></TR>
</TABLE><TABLE CLASS=side CELLSPACING=0 CELLPADDING=4><TR><TD CLASS=sideheader>More Information</TD></TR><TR><TD><A HREF="index.html" TARGET=_top>Introduction</A></TD></TR><TR><TD><A HREF="quickstart.html" TARGET=_top>Quick&nbsp;Start</A></TD></TR><TR><TD><A HREF="tutorial.html" TARGET=_top>Tutorial</A></TD></TR><TR><TD><A HREF="tools.html" TARGET=_top>Tools&nbsp;and&nbsp;Languages</A></TD></TR><TR><TD><A HREF="examples.html" TARGET=_top>Examples</A></TD></TR><TR><TD><A HREF="books.html" TARGET=_top>Books</A></TD></TR><TR><TD><A HREF="reference.html" TARGET=_top>Reference</A></TD></TR><TR><TD><A HREF="print.html" TARGET=_top>Print&nbsp;PDF</A></TD></TR><TR><TD><A HREF="about.html" TARGET=_top>About&nbsp;This&nbsp;Site</A></TD></TR><TR><TD><A HREF="updates.html" TARGET=_top>RSS&nbsp;Feed&nbsp;&amp;&nbsp;Blog</A></TD></TR></TABLE></DIV><script type="text/javascript">movecontent();</script></BODY></HTML>